<!DOCTYPE html>
<html >
<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<meta charset="BIG5">
<title>學生個人專區</title>
<style>
#uploadPicture{
	visibility: hidden;
}
#confirm{
	visibility: hidden;
}
.savePicture{
	visibility: hidden;
}
.saveclass {
  visibility: hidden;
}
.deleteCourse {
  visibility: hidden;
}
.managecoach {
  visibility: hidden;
}
.deletecoach {
  visibility: hidden;
}
h2{
display: inline-block;
}
.course{
	width:13rem;
	display: inline-block;
	margin-bottom:33px;
	margin-left:55px;
}
{
    box-sizing: border-box;
}

html,
body {
    margin-top: 2px;
    margin-bottom: 2px;
    margin-left: 27px;
    margin-right: 27px;
    padding: 0px;
}
.nav {
    font-size: 20px;
    margin-bottom: 25px;
}
</style>
</head>
<body>
<nav class="nav" style="background-color: #e3f2fd;">
  <a class="navbar-brand" href="#">shareSport</a>
    <ul class="nav justify-content-end">
    <li class="nav-item">
    	<a class="nav-link active" href="#">首頁</a>
  	</li>
  	<li class="nav-item">
    	<a class="nav-link active" href="#">瀏覽教練</a>
  	</li>
  	<li class="nav-item">
    	<a class="nav-link active" href="#">瀏覽教練</a>
  	</li>
  	<li class="nav-item">
    	<a class="nav-link active" href="#">個人專區</a>
  	</li>
  	<li class="nav-item">
    	<a class="nav-link active" href="#">管理介面</a>
  	</li>
  	<li class="nav-item">
    	<a class="nav-link active" id="sign" href="#">登入</a>
  	</li>
  	<li class="nav-item">
    	<a class="nav-link active" href="#">註冊</a>
  	</li>
   </ul>
  
</nav>
	<div class="card mb-3"  style="max-width: 540px;">
  		<div class="row no-gutters">
	    	<div id ="studentPicture" class="col-md-4"></div>
	    	<div class="col-md-8">
				<div class="card-body">
		        	<h2 id="studentName" class="card-title" ></h2><br>
		        	<a id = "studentAddress" href="coachmodify.html?id=' + value['id'] + '" type="button" class="btn btn-outline-primary" >修改個人資料</a>
		        	<button type="button" class="btn btn-outline-primary newPicture" >新增個人照片</button>
		        	<button type="button" class="btn btn-outline-primary savePicture" >儲存</button>
		        	<form id="uploadPicture" enctype="multipart/form-data">
						<input id="file" type="file" name="file" />
						<button id="upload" type="button">upload</button>
					</form>
	<button id="confirm" type="button">confirm</button>
				</div>
	    	</div>
	  </div>
	</div>
	
	<h2>我的教程</h2>
		<button id ="modifyclass" type="button" class="btn btn-outline-primary">管理教程</button>
		<button type="button" class="btn btn-outline-primary saveclass">儲存</button><br>
		<div id="coursesPanel" ></div>
			
	<h2>我的教練</h2>
		<button id="modifycoach" type="button" class="btn btn-outline-primary">管理教練</button>
		<button type="button" class="btn btn-outline-primary managecoach">儲存</button><br>
		<div id="coachesPanel" ></div>
			
		
	<script>
	var url_string = window.location.href;
	var url = new URL(url_string);
	//var id = url.searchParams.get("id");
	var sql_num = 0;
	
	var id=1;
	function getStudent(id) {
	       $.ajax({
	           type: "GET",
	           url: "api/student.do",
	           crossDomain: true,
	           data: "id="+id,
	           cache: false,
	           dataType: 'json',
	           timeout: 5000,
	           success: function (response) {
	               if(response.status == 200){
	               	document.getElementById('studentName').innerHTML = response['response']['data'][0]['name'];
	               	};
	               console.log(response);
	           },
	           error: function () {
	               alert("無法連線到伺服器！");
	           }
	       });
	   }
	
	function getStuCourseId(id) {//取得學生訂閱courseid
	       $.ajax({
	           type: "GET",
	           url: "api/subscribe.do",
	           crossDomain: true,
	           data: "sub_stuId=" +id,
	           cache: false,
	           dataType: 'json',
	           timeout: 5000,
	           success: function (response) {
	        	   console.log(response);
	               if(response.status == 200){
	            	   //console.log(response.response.data)
	            	   var arrstuCoursesid = [];
	            	   $.each(response.response.data,function(index, value){
	            		   arrstuCoursesid.push(value['sub_courId']);
	            		   getStuCourseInfo(value['sub_courId']);
	            		   
	            	   })
	            	   console.log(arrstuCoursesid);
	            	   };
	           },
	           error: function () {
	               alert("無法連線到伺服器！");
	           }
	       });
	   }
	function getStuCourseInfo(id) {//取得學生訂閱courseinfo
	       $.ajax({
	           type: "GET",
	           url: "api/course.do",
	           crossDomain: true,
	           data: "id="+id,
	           cache: false,
	           dataType: 'json',
	           timeout: 5000,
	           success: function (response) {
	        	   console.log(response);
	               if(response.status == 200){
	            	   //console.log(response.response.data)
	            	   addCourses(response.response.data);
	            	   
	            	}
	           },
	           error: function () {
	               alert("無法連線到伺服器！");
	           }
	       });
	   }
	 function isNumberKey(evt){//刪除特定coursecard
		   $('.deleteCourse').click(function(){
				alert("delete");
				console.log("刪除"+this.id);
				deleteCourse(this.id);
				//$("#coursesPanel").empty();
				//getCourse(id);
			});
		   };
		   
	   function addCourses(data) {//顯示學生訂閱課程
		   //console.log(data);
		   var courseAll = ""; 
			   if(data[0]['status']=="0"){//如果status =1(停權)則跳過
				 //console.log(index);   
	               courseAll += ' <div class="card course">';
	               courseAll += ' <a href="該教程網址">';
	               courseAll += '<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcTxDQcl1SA2jzxtsOqnl0eA-zF9p0JoDFZCALHVI25lqAdzR-Ec" class="card-img-top" alt="..."  width="13rem" height="160rem">';
	               courseAll += '</a>';
	               courseAll += '<div class="card-body">';
	               courseAll += '<h5 id ="courseName" class="card-title">'+data[0]['name']+'</h5>';
	               courseAll += '<p id ="courseTextarea" class="card-text">'+data[0]['information']+'</p>';
	               courseAll += '<p id ="subscribe'+data[0]['id']+'" class="card-text"><small class="text-muted">訂閱人數</small></p>';
	               courseAll += '<p hidden id ="status" class="card-text" ><small class="text-muted">'+data[0]['status']+'</small></p>';
	               courseAll += '<p hidden id ="id" class="card-text" ><small class="text-muted">'+data[0]['id']+'</small></p>';
	               //courseAll += '<a href="#" class="btn btn-primary modifythiscourse" >修改教程</a>';
	               courseAll += '<button id="'+data[0]['id']+'" type="button" name="deleteCourse" class="btn btn-primary deleteCourse" >取消訂閱</button>';
	               courseAll += '</div>';
	               courseAll += '</div>';
	               getSubscribes(data[0]['id']);
	               isNumberKey();
	               $("#coursesPanel").append(courseAll);//把所有COURSE資料顯現在COURSE區        
			   }
		   }
		  
	   function getSubscribes(id) {//取得課程訂閱人數
	       $.ajax({
	           type: "GET",
	           url: "api/subscribe.do",
	           crossDomain: true,
	           data: "id="+id,
	           cache: false,
	           dataType: 'json',
	           timeout: 5000,
	           success: function (response) {
	        	   //console.log(response);
	               if(response.status == 200){
	            	   document.getElementById('subscribe'+id).innerHTML = "<small>訂閱人數"+response.count;
	            	   console.log("id:"+id+" amount="+response.count);
	               	};
	               //console.log(response);
	           },
	           error: function () {
	               alert("無法連線到伺服器！");
	           }
	       });
	   }
	   function deleteCourse(deleteId) {//刪除COURSE並清空course資訊
			// 將資料組成JSON格式
		        var data_object = {
		            "id": deleteId,
		        };
		        // 將JSON格式轉換成字串
		        var data_string = JSON.stringify(data_object);
		        $.ajax({
		           type: "DELETE",
		           url: "api/course.do",
		           crossDomain: true,
		           data: data_string,
		           cache: false,
		           dataType: 'json',
		           timeout: 5000,
		           success: function (response) {
		               if(response.status == 200){
		            	 	$("#coursesPanel").empty();
		            	 	getCourse(id);
		            	 	
		               	}
		               console.log(response);
		           },
		           error: function () {
		               alert("無法連線到伺服器！");
		           }
		       });
		   }
	   function getStuCoachId(id) {//取得學生訂閱courseid
	       $.ajax({
	           type: "GET",
	           url: "api/follow.do",
	           crossDomain: true,
	           data: "foll_stuId=" +id,
	           cache: false,
	           dataType: 'json',
	           timeout: 5000,
	           success: function (response) {
	        	   console.log(response);
	               if(response.status == 200){
	            	   //console.log(response.response.data)
	            	   var arrstuCoachesid = [];
	            	   $.each(response.response.data,function(index, value){
	            		   arrstuCoachesid.push(value['foll_coaId']);
	            		   getCoachInfo(value['foll_coaId']);
	            		   
	            	   })
	            	   console.log(arrstuCoachesid);
	            	   };
	           },
	           error: function () {
	               alert("無法連線到伺服器！");
	           }
	       });
	   }
	   function getCoachInfo(id) {//取得coachinfo
	       $.ajax({
	           type: "GET",
	           url: "api/coach.do",
	           crossDomain: true,
	           data: "id="+id,
	           cache: false,
	           dataType: 'json',
	           timeout: 5000,
	           success: function (response) {
	        	   if(response.status == 200){
	        		   console.log(response.response.data);
	        		   addCoaches(response.response.data);
		               	}
	               console.log(response);
	           },
	           error: function () {
	               alert("無法連線到伺服器！");
	           }
	       });
	   }
	   function addCoaches(data) {//顯示學生訂閱課程
		   //console.log(data);
		   var courseAll = ""; 
			   if(data[0]['status']=="0"){//如果status =1(停權)則跳過
				 //console.log(index);   
	               courseAll += ' <div class="card course">';
	               courseAll += ' <a href="該教程網址">';
	               courseAll += '<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcTxDQcl1SA2jzxtsOqnl0eA-zF9p0JoDFZCALHVI25lqAdzR-Ec" class="card-img-top" alt="..."  width="13rem" height="160rem">';
	               courseAll += '</a>';
	               courseAll += '<div class="card-body">';
	               courseAll += '<h5 id ="courseName" class="card-title">'+data[0]['name']+'</h5>';
	               courseAll += '<p id ="courseTextarea" class="card-text">'+data[0]['information']+'</p>';
	               courseAll += '<p id ="follow'+data[0]['id']+'" class="card-text"><small class="text-muted">訂閱人數</small></p>';
	               courseAll += '<p hidden id ="status" class="card-text" ><small class="text-muted">'+data[0]['status']+'</small></p>';
	               courseAll += '<p hidden id ="id" class="card-text" ><small class="text-muted">'+data[0]['id']+'</small></p>';
	               //courseAll += '<a href="#" class="btn btn-primary modifythiscourse" >修改教程</a>';
	               courseAll += '<button id="'+data[0]['id']+'" type="button" name="deleteCourse" class="btn btn-primary deletecoach" >取消追蹤</button>';
	               courseAll += '</div>';
	               courseAll += '</div>';
	               getFollows(data[0]['id']);
	               isNumberKey();
	               $("#coachesPanel").append(courseAll);//把所有COURSE資料顯現在COURSE區        
			   }
		   }
	   function getFollows(id) {//取得課程訂閱人數
	       $.ajax({
	           type: "GET",
	           url: "api/follow.do",
	           crossDomain: true,
	           data: "id="+id,
	           cache: false,
	           dataType: 'json',
	           timeout: 5000,
	           success: function (response) {
	        	   //console.log(response);
	               if(response.status == 200){
	            	   document.getElementById('follow'+id).innerHTML = "<small>追蹤人數"+response.count;
	            	   console.log("id:"+id+" amount="+response.count);
	               	};
	               //console.log(response);
	           },
	           error: function () {
	               alert("無法連線到伺服器！");
	           }
	       });
	   }
	 $(document).ready(function() {
		 /**$.ajax({//取得登入者的ID
             type: "GET",
             url: "api/login.do",
             crossDomain: true,
             cache: false,
             dataType: 'json',
             timeout: 5000,
             success: function (response) {
                 if(response.status == 200){
               	 // console.log(response);
                 }
                 console.log(response);
                 id = response.response.data[0].id ;
                 role = response.role;
                 console.log(role);
                 console.log(id);
                 //document.getElementById('studentAddress').innerHTML = response['response']['data'][0]['id'];
                 //getStudent(id);
                 //getCourse(id);
                 //getCoachPic(id);
			      
             },
             error: function () {
                 alert("無法連線到伺服器！");
             }
     	   });**/
	   console.log(id);
	   getStudent(id);
	   getStuCourseId(id);
	   getStuCoachId(id)
             
     	   });
	 $(".newPicture").click(function(){
			$("#uploadPicture").css("visibility","visible");
			$("#confirm").css("visibility","visible");
			$(".savePicture").css("visibility","visible");
		})
		$(".savePicture").click(function(){
			$("#uploadPicture").css("visibility","hidden");
			$("#confirm").css("visibility","hidden");
			$(".savePicture").css("visibility","hidden");
		})
	$("#modifyself").click(function () {
		//要導入修改網址
	});
	$("#modifyclass").click(function () {
		$(".modifythiscourse").css("visibility","visible");
		$(".deleteCourse").css("visibility","visible");
		$(".saveclass").css("visibility","visible");
	});
		
	$(".saveclass").click(function(){
		$(".modifythiscourse").css("visibility","hidden");
		$(".deleteCourse").css("visibility","hidden");
		$(".saveclass").css("visibility","hidden");
	});
	     
	    
	    $("#modifycoach").click(function () {//管理教練
			$(".managecoach").css("visibility","visible");
			$(".deletecoach").css("visibility","visible");
		});
	    $(".managecoach").click(function () {//教練儲存
			$(".managecoach").css("visibility","hidden");
			$(".deletecoach").css("visibility","hidden");
		});
		var i = 0;//控制登入登出
        $("#sign").click(function () {
            if (i == 0) {
                document.getElementById("sign").innerHTML = "登出";
                i = 1;
            } else {
                document.getElementById("sign").innerHTML = "登入";
                i = 0;
            }
        });
		
        
	</script>
</body>
</html>